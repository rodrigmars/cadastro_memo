<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #notify {
            color: red;
            font-size: 25px;
        }
    </style>

</head>

<body>
    <label id="notify"></label>
    <div>
        <div>
            <label for="txtName">Nome</label>
            <input type="text" name="" id="txtName">*
        </div>
        <div>
            <label for="txtEmail">Email</label>
            <input type="text" name="" id="txtEmail">*
        </div>
        <div>
            <label for="txtTelephone">Telefone</label>
            <input type="text" name="" id="txtTelephone">*
        </div>
        <div><button id="btnAdd">Adicionar</button></div>
    </div>
    <br>
    <div id="containerUsers" style="width:300px">
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="chkAll"></th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Telephone</th>
                </tr>
            </thead>
            <tbody id="tbodyUsers">
            </tbody>
        </table>
    </div>
    <div>
        <button id="btnRemove">Excluir</button>
    </div>
</body>

</html>
<script>
    //Estrutura IIFE(Immediately Invoked Function Expression)
    function checkForm(name, email, telephone, notify, users) {
        if (name.value.trim().length < 1) {
            name.style.backgroundColor = "yellow";
            name.focus();
            return false;
        }

        if (email.value.trim().length < 1) {
            email.style.backgroundColor = "yellow";
            email.focus();
            return false;
        }

        if (users.find(data => data === email.value)) {
            notify.innerText = `E-mail ${email.value} já informado`;
            email.select();
            email.style.color = "red";
            email.style.backgroundColor = "yellow";
            return false;
        }

        if (telephone.value.trim().length < 1) {
            telephone.style.backgroundColor = "yellow";
            telephone.focus();
            return false;
        }


        return true;
    }

    function buildTemplate(index, name, email, telephone) {
        return `<tr>
            <td><input type="checkbox" value="${index}" name="chkUser"></td>
            <td>${name}</td>
            <td>${email}</td>
            <td>${telephone}</td>
            </div></tr>`
    }

    function resetForm(name, email, telephone) {

        name.value = "";
        email.value = "";
        telephone.value = "";
        name.style.backgroundColor = "";
        email.style.backgroundColor = "";
        telephone.style.backgroundColor = "";
        email.style.color = "";

        name.focus();
    }

    ; (function (logger, checkForm, buildTemplate, resetForm) {

        const name = document.getElementById("txtName");
        const email = document.getElementById("txtEmail");
        const telephone = document.getElementById("txtTelephone");
        const chkAll = document.getElementById("chkAll");
        const buttonAdd = document.getElementById("btnAdd");
        const buttonRemove = document.getElementById("btnRemove");
        const containerUsers = document.getElementById("containerUsers");
        const notify = document.getElementById("notify");
        const tbodyUsers = document.getElementById("tbodyUsers");

        let users = [];
        let totalUsers = 0

        buttonAdd.addEventListener("click", () => {

            if (totalUsers === 15) {
                notify.innerText = "Limite total de usuários excedidos";
                buttonAdd.disabled = true;
                return;
            }

            if (checkForm(name, email, telephone, notify, users)) {

                users.push([name.value, email.value, telephone.value]);

                tbodyUsers.innerHTML += buildTemplate(totalUsers, name.value, email.value, telephone.value);

                totalUsers += 1;

                resetForm(name, email, telephone);

                notify.innerText = "";
            }
        });

        chkAll.addEventListener("change", () =>
            document.getElementsByName("chkUser")
                .forEach(chk => chk.checked = !!chkAll.checked));

        buttonRemove.addEventListener("click", () => {

            const elements = document.querySelectorAll('input[name=chkUser]:checked')

            if (elements.length < 1) {
                logger("Selecione um registo para exclusão");
                return;
            }

            elements.forEach((item, index) => {

                // item.parentNode.parentNode.remove();

                item.closest('tr').remove();

                chkAll.checked = false;

                users.splice(index, 1);

                totalUsers -= 1;

            })

        });


    })(console.log, checkForm, buildTemplate, resetForm);

</script>